<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Python Tuple Syntax Is Confusing - dino (dot) codes</title><link rel="icon" type="image/png" href=static/favicon.ico /><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Python Tuple Syntax Is Confusing" />
<meta property="og:description" content="Post about how Python&#39;s tuple syntax can make you run around trying to fix bugs that are easily avoided." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dino.codes/posts/python-tuple-syntax-is-confusing/" />

<meta property="og:image" content="https://dino.codes/favicon.ico" />
<meta property="article:published_time" content="2019-12-23T12:41:57+00:00" />
<meta property="article:modified_time" content="2019-12-23T12:41:57+00:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://dino.codes/favicon.ico"/>

<meta name="twitter:title" content="Python Tuple Syntax Is Confusing"/>
<meta name="twitter:description" content="Post about how Python&#39;s tuple syntax can make you run around trying to fix bugs that are easily avoided."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://dino.codes/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://dino.codes/css/main.css" />
		<link rel="stylesheet" type="text/css" href="https://dino.codes/css/custom.css" />
	

	<script src="https://dino.codes/js/feather.min.js"></script>
	
		<script src="https://dino.codes/js/main.js"></script><script src="https://dino.codes/js/custom.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://dino.codes/">dino (dot) codes</a></h1>
	<div class="site-description"><p>Thoughts and opinions on Software Development and Music Production.</p><nav class="nav social">
			<ul class="flat"><li><a href="https://soundcloud.com/dino-costa-180136083" title="Soundcloud"><i data-feather="music"></i></a></li><li><a href="https://twitter.com/joaofcosta_" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://github.com/joaofcosta/" title="Github"><i data-feather="github"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">Posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header post-header-block">
				<div class="matter">
					<h1 class="title">Python Tuple Syntax Is Confusing</h1>
				</div>
				
					<div class="meta">
						<div>
							<span>23</span>
							<span>Dec, 2019</span>
						</div>
					</div>
				
			</div>

			<div class="markdown">
				

<p>Creating a list or a set with only one element, in Python, is pretty straight forward:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># one element list.</span>
<span style="color:#111">[</span><span style="color:#d88200">&#34;this is a list&#34;</span><span style="color:#111">]</span>

<span style="color:#75715e"># one element set.</span>
<span style="color:#111">{</span><span style="color:#d88200">&#34;this is a set&#34;</span><span style="color:#111">}</span></code></pre></div>
<p>However, that&rsquo;s not the case if you want to create a tuple with only one element:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#111">(</span><span style="color:#d88200">&#34;sorry! this is not a tuple&#34;</span><span style="color:#111">)</span></code></pre></div>
<p>Yup, unfortunately the way you create a one element tuple does not conform with
the rest of the data structures in Python which you can create using &ldquo;special&rdquo; characters.</p>

<p>If you want to create a tuple with only one element you must not forget the
final comma:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#111">(</span><span style="color:#d88200">&#34;this is now a tuple thanks to the comma&#34;</span><span style="color:#111">,)</span></code></pre></div>
<p>I think this is bad. First, because it&rsquo;s different from all the other listed above, and second,
because a string, as well as a list, a set or a tuple, is also enumerable. So, for functions that
are expecting enumerables, if you provide them with a string they will &ldquo;sort of&rdquo; work.</p>

<p>A coworker of mine justified the behaviour with:</p>

<blockquote>
<p>&ldquo;But you need the parenthesis in order to separate math operations.
How would you differentiate between a tuple with one int and a parenthesis which is only
wrapping a mathematical operation?&rdquo;</p>
</blockquote>

<p>Namely:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#111">(</span><span style="color:#ae81ff">2</span><span style="color:#111">)</span>

<span style="color:#111">(</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span><span style="color:#111">)</span></code></pre></div>
<p>Which is an understable argument seeing as we still need the ability to use paranthesis in
mathematical operations but, the truth is, when I think of the first I think we&rsquo;re creating a tuple,
however, its result is the same as the second expression.</p>

<h2 id="getting-bit-by-it">Getting bit by it!</h2>

<p>Why did I bother making a blog post about this? Mostly because I got bitten by this little Python
behaviour at work.</p>

<p>I was updating one codebase&rsquo;s tests, which uses
<a href="https://github.com/pnuckowski/aioresponses">aioresponse</a> in order to mock web requests when
working with <a href="https://aiohttp.readthedocs.io/en/stable/">aiohttp</a>.  We were using it as a context
manager, and you can provide a <code>passthrough</code> parameter to it, this should be an iterable, which
contains all the hosts that aioresponse must not mock. Since we were doing service level tests we
don&rsquo;t want to mock requests to the actual service&rsquo;s URL.</p>

<p>This is how the specific code that uses aioresponse was when I started working on it:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00a8c8">with</span> <span style="color:#111">aioresponses</span><span style="color:#111">(</span><span style="color:#111">passthrough</span><span style="color:#f92672">=</span><span style="color:#111">(</span><span style="color:#111">service_host</span><span style="color:#111">,</span> <span style="color:#111">external_url</span><span style="color:#111">))</span> <span style="color:#00a8c8">as</span> <span style="color:#111">responses</span><span style="color:#111">:</span>
    <span style="color:#00a8c8">yield</span> <span style="color:#111">responses</span></code></pre></div>
<p><code>service_host</code> refers to the URL of the service being updated/maintained, while <code>external_url</code> was
the URL of another service in which the one being updated depends on.</p>

<p>I decided to update this so as to mock the calls to the <code>external_url</code> since we want to avoid,
as much as possible, having to make HTTP requests to other services when doing service level tests.
As such, I updated the <code>passthrough</code> parameter as seen in the code below:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00a8c8">with</span> <span style="color:#111">aioresponses</span><span style="color:#111">(</span><span style="color:#111">passthrough</span><span style="color:#f92672">=</span><span style="color:#111">(</span><span style="color:#111">service_host</span><span style="color:#111">))</span> <span style="color:#00a8c8">as</span> <span style="color:#111">responses</span><span style="color:#111">:</span>
    <span style="color:#00a8c8">yield</span> <span style="color:#111">responses</span></code></pre></div>
<p>As you can probably notice, I forgot to add the final comma&hellip;</p>

<p>So, now instead of providing a tuple to <code>passthrough</code> we were providing a string. However, since a
string can also be iterated the code wasn&rsquo;t broken per say.  When running the test suite no errors
were thrown but the test suite didn&rsquo;t run successfully.</p>

<p>When looking at <code>aioresponse</code>&rsquo;s codebase we noticed that it iterates through the <code>passthrough</code> value
and checks if the current URL starts with any of the values in <code>passthrough</code>.</p>

<p><strong>Since we only passed a string, when iterating through <code>passthrough</code> the first value will be
<code>&quot;h&quot;</code></strong>. Can you see where this is going?</p>

<p>I&rsquo;ll leave a snippet here to give you and idea of what I&rsquo;m talking about:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#111">passthrough</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#d88200">&#34;http://do_not_mock.com&#34;</span><span style="color:#111">)</span>
<span style="color:#111">current_url</span> <span style="color:#f92672">=</span> <span style="color:#d88200">&#34;http://mock_me.com&#34;</span>

<span style="color:#00a8c8">for</span> <span style="color:#111">url</span> <span style="color:#f92672">in</span> <span style="color:#111">passthrough</span><span style="color:#111">:</span>
  <span style="color:#00a8c8">if</span> <span style="color:#111">current_url</span><span style="color:#f92672">.</span><span style="color:#111">startswith</span><span style="color:#111">(</span><span style="color:#111">url</span><span style="color:#111">):</span>
    <span style="color:#75715e"># Do not mock current_url!</span></code></pre></div>
<p>Basically no HTTP requests were being mocked because all the URLs used in the test suite start with
<code>&quot;http&quot;</code> (<em>well, that&rsquo;s a first!</em>) and <code>&quot;http...&quot;.startswith(&quot;h&quot;)</code> does return <code>True</code>. All of this,
and three hours lost, because of a sneaky comma!!!</p>

<h2 id="conclusion">Conclusion</h2>

<p>In conclusion, I know there&rsquo;s probably not much of an use for a one element tuple but it&rsquo;s a bit
frustating that it relies on that single command at the end, which a lot of people, like me,
might accidentaly delete while messing around a codebase.</p>

<p>I also know that Python is not the only language to have this kind of &ldquo;issues&rdquo; (not really an issue
  but you get what I&rsquo;m saying) so I&rsquo;m not trying to bash on Python or stating that
  <a href="https://github.com/pnuckowski/aioresponses">aioresponse</a> should be updated to handle this scenario,</p>

<p>I just think we could have better tuple syntax in Python so as to avoid this kind of confusion.</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/python">Python</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>

<script>feather.replace()</script>
</body>
</html>
